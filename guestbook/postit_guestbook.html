<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>í¬ìŠ¤íŠ¸ì‡ ë°©ëª…ë¡!</title>
  <script src="prompt.js"></script>
</head>
<style>
  @font-face {
    font-family: 'ImcreSoojin';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@2.3/ImcreSoojin.woff') format('woff');
    font-weight: normal;
    font-style: normal;
  }

  @font-face {
    font-family: 'SUITE-Regular';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-2@1.0/SUITE-Regular.woff2') format('woff2');
    font-weight: 400;
    font-style: normal;
  }



  .garland {
    width: 100%;
    height: 100%;
  }

  .guestbookText {
    padding-top: 50px;
    padding-bottom: 50px;

  }

  .HeadText1 {
    font-family: 'ImcreSoojin';
    font-size: 40px;
    color: #00632C;
    margin: 20px 0;
    font-weight: bold;
    text-align: center;
  }

  .text1 {
    margin: 20px 0;
    text-align: center;
    font-family: 'SUITE-Regular';
    font-size: 20px;
    line-height: 2.1;
  }


  .guestBook {
    width: 80%;
    margin: 0 auto;
  }

  .guestBook-content {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-evenly;
    margin: 0 auto
  }

  .addPostIt,
  .viewPostIt,
  .editPostIt {
    flex: 0 0 250px;
    height: 250px;
    margin-top: 25px;
    background-image: url('https://lh3.googleusercontent.com/proxy/TA1u2Kl-OnZDm-PmxghFol4ArgfjSOv7yS6iZkyfkwryGgc5WlTrPCnbLXELjMvD2VMWGFSEXm6jdXH-4dHv5FNF_6ELnJETHRlYv-cWTedKs6VNdEPbsVWrYJnKVDCUR0xb');
    background-position: center;
    background-size: cover;
  }

  .addPostIt {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .addPostItBtn {
    padding: 10px 20px;
    background-color: transparent;
    border-radius: 15px;
    font-size: 35px;
    border-color: transparent;
  }

  .guestBook-bottom {
    padding-top: 50px;
    padding-bottom: 50px;
  }

  .guestBook-bottom {
    height: 10px;
  }

  .content_t {
    display: flex;
    /* Flex ì»¨í…Œì´ë„ˆë¡œ ì„¤ì • */
    justify-content: center;
    /* ìˆ˜í‰ ê°€ìš´ë° ì •ë ¬ */
    align-items: center;
    /* ìˆ˜ì§ ê°€ìš´ë° ì •ë ¬ */
    height: 70%;
  }

  .name_t {
    text-align: center;
  }

  
.editPostIt div {
    margin-bottom: 10px; /* ì…ë ¥ ë°•ìŠ¤ ì‚¬ì´ì˜ ê°„ê²©ì„ ì¡°ì ˆ */
    display: flex;
    /* Flex ì»¨í…Œì´ë„ˆë¡œ ì„¤ì • */
    justify-content: center;
    /* ìˆ˜í‰ ê°€ìš´ë° ì •ë ¬ */
    align-items: center;
    /* ìˆ˜ì§ ê°€ìš´ë° ì •ë ¬ */
}

.editPostIt > .input1 {
  padding-top: 30px;
}

.editPostIt input[type="text"] {
  margin-left: -15px;
    width: 70%; /* ì…ë ¥ ë°•ìŠ¤ì˜ ë„ˆë¹„ë¥¼ ë¶€ëª¨ ìš”ì†Œì˜ ë„ˆë¹„ì˜ 80%ë¡œ ì„¤ì • */
    padding: 8px;
    font-size: 15px;
    border: 1px solid #ccc;
    border-radius: 10px;
    text-align: center;
}
</style>

<body>
  <div class="garland">
    <h1>
      <img src="garland.png">
    </h1>
  </div>
  <div class="guestbookText">
    <div class="HeadText1">ì—¬ê¸°ë´zoo ë°©ëª…ë¡</div>
    <div class="text1">ì½”ë“œë§Œë“¤ì–´íŒ”ì¡°ì—ê²Œ 8ê¸€ìë¡œ ë°©ëª…ë¡ì„ ë‚¨ê²¨ì£¼ì„¸ìš”</div>
  </div>
  <div class="guestBook">

    <div class="guestBook-content">

      <!--    <div class="editPostIt">-->
      <!--      <button class="checkBtn" id="checkBtn">âœ”ï¸</button>-->
      <!--      <button class="cancelBtn" id="cancelBtn">âŒ</button>-->
      <!--      <div><input type="text" placeholder="ì´ë¦„" id="name"></div>-->
      <!--      <div><input type="text" placeholder="ë¹„ë°€ë²ˆí˜¸" id="password"></div>-->
      <!--      <div><input type="text" placeholder="ë‚´ìš©" id="content"></div>-->
      <!--    </div>-->

      <!--        <div class="viewPostIt">-->
      <!--          <button class="editBtn">âœï¸</button>-->
      <!--          <button class="cancelBtn">âŒ</button>-->
      <!--          <div><span>ë‚´ìš©</span></div>-->
      <!--          <div>-<span>ì´ë¦„</span>-</div>-->
      <!--        </div>-->

      <div class="addPostIt">
        <button class="addPostItBtn" onclick="addPostIt()">+
        </button>
      </div>

    </div>
  </div>
  <div class="guestBook-bottom">

  </div>

  <script>
    // // Firestore URL
    const endPointUrl = "https://firestore.googleapis.com/v1";
    const baseUrl = "https://firestore.googleapis.com/v1/projects/miniproject-739f0/databases/(default)/documents/guestBook";

    const guestBook_content = document.getElementsByClassName("guestBook-content")[0];

    document.addEventListener("DOMContentLoaded", function () {
      console.log("2");
      reloadPostIt();
    });

    function reloadPostIt() {
      guestBook_content.innerHTML = `<div class="addPostIt">
      <button class="addPostItBtn"
              onclick="addPostIt()">â•
      </button>
    </div>`;
      // ëª¨ë“  ì‚­ì œê°€ ì™„ë£Œëœ í›„ì— displayAllPostIt() í•¨ìˆ˜ë¥¼ í˜¸ì¶œ
      displayAllPostIt();
    }

    async function displayAllPostIt() {
      let data = await getData();
      console.log(data);
      data.documents.forEach(doc => {
        // console.log(doc);
        let name = doc.fields.name.stringValue;
        // let password = doc.fields.password.stringValue;
        let content = doc.fields.content.stringValue;
        let pk = doc.name;
        let template = `
        <div class="viewPostIt">
          <button class="editBtn" onclick="passwordPrompt(); editPostIt('${pk}');">âœï¸</button>
          <button class="cancelBtn" onclick="passwordPrompt(); deletePostIt('${pk}');">ğŸ—‘ï¸</button>
          <div class = "content_t"><span>${content}</span></div>
          <div class = "name_t">-<span>${name}</span>-</div>
        </div>`
        guestBook_content.insertAdjacentHTML('afterbegin', template);
      })
    }

    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    async function getData() {
      try {
        const response = await fetch(baseUrl);
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        let data = await response.json();
        console.log("ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!", data);
        return data;
      } catch (error) {
        console.error('Error:', error);
        throw error; // ì—ëŸ¬ë¥¼ ë‹¤ì‹œ throwí•˜ì—¬ ì´í›„ì— ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•¨
      }
    }

    //í¬ìŠ¤íŠ¸ì‡ ì¶”ê°€í•˜ê¸°
    let isAlreadyAddPostIt = false;
    function addPostIt() {
      if (!isAlreadyAddPostIt) {
        isAlreadyAddPostIt = true;
        let addPostItForm = ` <div class="editPostIt">
      <button class="checkBtn" id="checkBtn" >âœ”ï¸</button>
      <button class="cancelBtn" id="cancelBtn" onclick = "cancelConfirm()">âŒ</button>
      <div class = "input1"><input type="text" placeholder="ì´ë¦„" id="name"></div>
      <div><input type="text" placeholder="ë¹„ë°€ë²ˆí˜¸" id="password"></div>
      <div><input type="text" placeholder="ë‚´ìš©" id="content"></div>
    </div>`;

        let addPostIt = document.getElementsByClassName("addPostIt")[0];
        addPostIt.insertAdjacentHTML('beforebegin', addPostItForm);

        let editPostItForms = Array.from(document.getElementsByClassName("editPostIt"));

        editPostItForms.forEach(editPostItForm => {
          let checkBtn = editPostItForm.querySelector("#checkBtn");

          checkBtn.addEventListener("click",
            async function () {
              let name = editPostItForm.querySelector("#name").value;
              let password = editPostItForm.querySelector("#password").value;
              let content = editPostItForm.querySelector("#content").value;

              // console.log(name, password, content);
              await addData(name, password, content);
              console.log("1");
              isAlreadyAddPostIt = false;
            })
        })
      }
    }

    // ë°ì´í„° ì¶”ê°€
    function addData(name, password, content) {
      const data = {
        name: { stringValue: name },
        password: { stringValue: password },
        content: { stringValue: content }
      };

      const requestOptions = {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ fields: data })
      };

      fetch(baseUrl, requestOptions)
        .then(response => response.json())
        .then(async data => {
          console.log(data);
          await reloadPostIt();
        })
        .catch(error => console.error('Error:', error));
    }

    // async function editPostIt(pk){
    //   await updateData(pk);
    // }

    // // // ë°ì´í„° ìˆ˜ì •
    // function updateData(documentId, newData) {
    //   const url = `${baseUrl}/${documentId}`;
    //
    //   const requestOptions = {
    //     method: 'PATCH',
    //     headers: {
    //       'Content-Type': 'application/json'
    //     },
    //     body: JSON.stringify({fields: newData})
    //   };
    //
    //   fetch(url, requestOptions)
    //     .then(response => response.json())
    //     .then(data => console.log(data))
    //     .catch(error => console.error('Error:', error));
    // }

    async function deletePostIt(pk) {
      await deleteData(pk);
    }

    // ë°ì´í„° ì‚­ì œ-->
    function deleteData(pk) {
      const url = `${endPointUrl}/${pk}`;

      const requestOptions = {
        method: 'DELETE',
      };

      fetch(url, requestOptions)
        .then(async response => {
          console.log('Data deleted successfully');
          await reloadPostIt();
        })
        .catch(error => console.error('Error:', error));
    }
  </script>
</body>

</html>